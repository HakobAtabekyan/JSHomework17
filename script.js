const products = [{ "id": 1, "title": "iPhone 9", "description": "An apple mobile which is nothing like apple", "price": 549, "discountPercentage": 12.96, "rating": 4.69, "stock": 94, "brand": "Apple", "category": "smartphones", "thumbnail": "https://i.dummyjson.com/data/products/1/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/1/1.jpg", "https://i.dummyjson.com/data/products/1/2.jpg", "https://i.dummyjson.com/data/products/1/3.jpg", "https://i.dummyjson.com/data/products/1/4.jpg", "https://i.dummyjson.com/data/products/1/thumbnail.jpg"] }, { "id": 2, "title": "iPhone X", "description": "SIM-Free, Model A19211 6.5-inch Super Retina HD display with OLED technology A12 Bionic chip with ...", "price": 899, "discountPercentage": 17.94, "rating": 4.44, "stock": 34, "brand": "Apple", "category": "smartphones", "thumbnail": "https://i.dummyjson.com/data/products/2/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/2/1.jpg", "https://i.dummyjson.com/data/products/2/2.jpg", "https://i.dummyjson.com/data/products/2/3.jpg", "https://i.dummyjson.com/data/products/2/thumbnail.jpg"] }, { "id": 3, "title": "Samsung Universe 9", "description": "Samsung's new variant which goes beyond Galaxy to the Universe", "price": 1249, "discountPercentage": 15.46, "rating": 4.09, "stock": 36, "brand": "Samsung", "category": "smartphones", "thumbnail": "https://i.dummyjson.com/data/products/3/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/3/1.jpg"] }, { "id": 4, "title": "OPPOF19", "description": "OPPO F19 is officially announced on April 2021.", "price": 280, "discountPercentage": 17.91, "rating": 4.3, "stock": 123, "brand": "OPPO", "category": "smartphones", "thumbnail": "https://i.dummyjson.com/data/products/4/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/4/1.jpg", "https://i.dummyjson.com/data/products/4/2.jpg", "https://i.dummyjson.com/data/products/4/3.jpg", "https://i.dummyjson.com/data/products/4/4.jpg", "https://i.dummyjson.com/data/products/4/thumbnail.jpg"] }, { "id": 5, "title": "Huawei P30", "description": "Huawei’s re-badged P30 Pro New Edition was officially unveiled yesterday in Germany and now the device has made its way to the UK.", "price": 499, "discountPercentage": 10.58, "rating": 4.09, "stock": 0, "brand": "Huawei", "category": "smartphones", "thumbnail": "https://i.dummyjson.com/data/products/5/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/5/1.jpg", "https://i.dummyjson.com/data/products/5/2.jpg", "https://i.dummyjson.com/data/products/5/3.jpg"] }, { "id": 6, "title": "MacBook Pro", "description": "MacBook Pro 2021 with mini-LED display may launch between September, November", "price": 1749, "discountPercentage": 11.02, "rating": 4.57, "stock": 83, "brand": "Apple", "category": "laptops", "thumbnail": "https://i.dummyjson.com/data/products/6/thumbnail.png", "images": ["https://i.dummyjson.com/data/products/6/1.png", "https://i.dummyjson.com/data/products/6/2.jpg", "https://i.dummyjson.com/data/products/6/3.png", "https://i.dummyjson.com/data/products/6/4.jpg"] }, { "id": 7, "title": "Samsung Galaxy Book", "description": "Samsung Galaxy Book S (2020) Laptop With Intel Lakefield Chip, 8GB of RAM Launched", "price": 1499, "discountPercentage": 4.15, "rating": 4.25, "stock": 50, "brand": "Samsung", "category": "laptops", "thumbnail": "https://i.dummyjson.com/data/products/7/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/7/1.jpg", "https://i.dummyjson.com/data/products/7/2.jpg", "https://i.dummyjson.com/data/products/7/3.jpg", "https://i.dummyjson.com/data/products/7/thumbnail.jpg"] }, { "id": 8, "title": "Microsoft Surface Laptop 4", "description": "Style and speed. Stand out on HD video calls backed by Studio Mics. Capture ideas on the vibrant touchscreen.", "price": 1499, "discountPercentage": 10.23, "rating": 4.43, "stock": 0, "brand": "Microsoft Surface", "category": "laptops", "thumbnail": "https://i.dummyjson.com/data/products/8/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/8/1.jpg", "https://i.dummyjson.com/data/products/8/2.jpg", "https://i.dummyjson.com/data/products/8/3.jpg", "https://i.dummyjson.com/data/products/8/4.jpg", "https://i.dummyjson.com/data/products/8/thumbnail.jpg"] }, { "id": 9, "title": "Infinix INBOOK", "description": "Infinix Inbook X1 Ci3 10th 8GB 256GB 14 Win10 Grey – 1 Year Warranty", "price": 1099, "discountPercentage": 11.83, "rating": 4.54, "stock": 96, "brand": "Infinix", "category": "laptops", "thumbnail": "https://i.dummyjson.com/data/products/9/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/9/1.jpg", "https://i.dummyjson.com/data/products/9/2.png", "https://i.dummyjson.com/data/products/9/3.png", "https://i.dummyjson.com/data/products/9/4.jpg", "https://i.dummyjson.com/data/products/9/thumbnail.jpg"] }, { "id": 10, "title": "HP Pavilion 15-DK1056WM", "description": "HP Pavilion 15-DK1056WM Gaming Laptop 10th Gen Core i5, 8GB, 256GB SSD, GTX 1650 4GB, Windows 10", "price": 1099, "discountPercentage": 6.18, "rating": 4.43, "stock": 89, "brand": "HP Pavilion", "category": "laptops", "thumbnail": "https://i.dummyjson.com/data/products/10/thumbnail.jpeg", "images": ["https://i.dummyjson.com/data/products/10/1.jpg", "https://i.dummyjson.com/data/products/10/2.jpg", "https://i.dummyjson.com/data/products/10/3.jpg", "https://i.dummyjson.com/data/products/10/thumbnail.jpeg"] }, { "id": 11, "title": "perfume Oil", "description": "Mega Discount, Impression of Acqua Di Gio by GiorgioArmani concentrated attar perfume Oil", "price": 13, "discountPercentage": 8.4, "rating": 4.26, "stock": 65, "brand": "Impression of Acqua Di Gio", "category": "fragrances", "thumbnail": "https://i.dummyjson.com/data/products/11/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/11/1.jpg", "https://i.dummyjson.com/data/products/11/2.jpg", "https://i.dummyjson.com/data/products/11/3.jpg", "https://i.dummyjson.com/data/products/11/thumbnail.jpg"] }, { "id": 12, "title": "Brown Perfume", "description": "Royal_Mirage Sport Brown Perfume for Men & Women - 120ml", "price": 40, "discountPercentage": 15.66, "rating": 4, "stock": 52, "brand": "Royal_Mirage", "category": "fragrances", "thumbnail": "https://i.dummyjson.com/data/products/12/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/12/1.jpg", "https://i.dummyjson.com/data/products/12/2.jpg", "https://i.dummyjson.com/data/products/12/3.png", "https://i.dummyjson.com/data/products/12/4.jpg", "https://i.dummyjson.com/data/products/12/thumbnail.jpg"] }, { "id": 13, "title": "Fog Scent Xpressio Perfume", "description": "Product details of Best Fog Scent Xpressio Perfume 100ml For Men cool long lasting perfumes for Men", "price": 13, "discountPercentage": 8.14, "rating": 4.59, "stock": 61, "brand": "Fog Scent Xpressio", "category": "fragrances", "thumbnail": "https://i.dummyjson.com/data/products/13/thumbnail.webp", "images": ["https://i.dummyjson.com/data/products/13/1.jpg", "https://i.dummyjson.com/data/products/13/2.png", "https://i.dummyjson.com/data/products/13/3.jpg", "https://i.dummyjson.com/data/products/13/4.jpg", "https://i.dummyjson.com/data/products/13/thumbnail.webp"] }, { "id": 14, "title": "Non-Alcoholic Concentrated Perfume Oil", "description": "Original Al Munakh® by Mahal Al Musk | Our Impression of Climate | 6ml Non-Alcoholic Concentrated Perfume Oil", "price": 120, "discountPercentage": 15.6, "rating": 4.21, "stock": 114, "brand": "Al Munakh", "category": "fragrances", "thumbnail": "https://i.dummyjson.com/data/products/14/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/14/1.jpg", "https://i.dummyjson.com/data/products/14/2.jpg", "https://i.dummyjson.com/data/products/14/3.jpg", "https://i.dummyjson.com/data/products/14/thumbnail.jpg"] }, { "id": 15, "title": "Eau De Perfume Spray", "description": "Genuine  Al-Rehab spray perfume from UAE/Saudi Arabia/Yemen High Quality", "price": 30, "discountPercentage": 10.99, "rating": 4.7, "stock": 105, "brand": "Lord - Al-Rehab", "category": "fragrances", "thumbnail": "https://i.dummyjson.com/data/products/15/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/15/1.jpg", "https://i.dummyjson.com/data/products/15/2.jpg", "https://i.dummyjson.com/data/products/15/3.jpg", "https://i.dummyjson.com/data/products/15/4.jpg", "https://i.dummyjson.com/data/products/15/thumbnail.jpg"] }, { "id": 16, "title": "Hyaluronic Acid Serum", "description": "L'OrÃ©al Paris introduces Hyaluron Expert Replumping Serum formulated with 1.5% Hyaluronic Acid", "price": 19, "discountPercentage": 13.31, "rating": 4.83, "stock": 110, "brand": "L'Oreal Paris", "category": "skincare", "thumbnail": "https://i.dummyjson.com/data/products/16/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/16/1.png", "https://i.dummyjson.com/data/products/16/2.webp", "https://i.dummyjson.com/data/products/16/3.jpg", "https://i.dummyjson.com/data/products/16/4.jpg", "https://i.dummyjson.com/data/products/16/thumbnail.jpg"] }, { "id": 17, "title": "Tree Oil 30ml", "description": "Tea tree oil contains a number of compounds, including terpinen-4-ol, that have been shown to kill certain bacteria,", "price": 12, "discountPercentage": 4.09, "rating": 4.52, "stock": 78, "brand": "Hemani Tea", "category": "skincare", "thumbnail": "https://i.dummyjson.com/data/products/17/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/17/1.jpg", "https://i.dummyjson.com/data/products/17/2.jpg", "https://i.dummyjson.com/data/products/17/3.jpg", "https://i.dummyjson.com/data/products/17/thumbnail.jpg"] }, { "id": 18, "title": "Oil Free Moisturizer 100ml", "description": "Dermive Oil Free Moisturizer with SPF 20 is specifically formulated with ceramides, hyaluronic acid & sunscreen.", "price": 40, "discountPercentage": 13.1, "rating": 4.56, "stock": 88, "brand": "Dermive", "category": "skincare", "thumbnail": "https://i.dummyjson.com/data/products/18/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/18/1.jpg", "https://i.dummyjson.com/data/products/18/2.jpg", "https://i.dummyjson.com/data/products/18/3.jpg", "https://i.dummyjson.com/data/products/18/4.jpg", "https://i.dummyjson.com/data/products/18/thumbnail.jpg"] }, { "id": 19, "title": "Skin Beauty Serum.", "description": "Product name: rorec collagen hyaluronic acid white face serum riceNet weight: 15 m", "price": 46, "discountPercentage": 10.68, "rating": 4.42, "stock": 54, "brand": "ROREC White Rice", "category": "skincare", "thumbnail": "https://i.dummyjson.com/data/products/19/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/19/1.jpg", "https://i.dummyjson.com/data/products/19/2.jpg", "https://i.dummyjson.com/data/products/19/3.png", "https://i.dummyjson.com/data/products/19/thumbnail.jpg"] }, { "id": 20, "title": "Freckle Treatment Cream- 15gm", "description": "Fair & Clear is Pakistan's only pure Freckle cream which helpsfade Freckles, Darkspots and pigments. Mercury level is 0%, so there are no side effects.", "price": 70, "discountPercentage": 16.99, "rating": 4.06, "stock": 140, "brand": "Fair & Clear", "category": "skincare", "thumbnail": "https://i.dummyjson.com/data/products/20/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/20/1.jpg", "https://i.dummyjson.com/data/products/20/2.jpg", "https://i.dummyjson.com/data/products/20/3.jpg", "https://i.dummyjson.com/data/products/20/4.jpg", "https://i.dummyjson.com/data/products/20/thumbnail.jpg"] }, { "id": 21, "title": "- Daal Masoor 500 grams", "description": "Fine quality Branded Product Keep in a cool and dry place", "price": 20, "discountPercentage": 4.81, "rating": 4.44, "stock": 133, "brand": "Saaf & Khaas", "category": "groceries", "thumbnail": "https://i.dummyjson.com/data/products/21/thumbnail.png", "images": ["https://i.dummyjson.com/data/products/21/1.png", "https://i.dummyjson.com/data/products/21/2.jpg", "https://i.dummyjson.com/data/products/21/3.jpg"] }, { "id": 22, "title": "Elbow Macaroni - 400 gm", "description": "Product details of Bake Parlor Big Elbow Macaroni - 400 gm", "price": 14, "discountPercentage": 15.58, "rating": 4.57, "stock": 146, "brand": "Bake Parlor Big", "category": "groceries", "thumbnail": "https://i.dummyjson.com/data/products/22/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/22/1.jpg", "https://i.dummyjson.com/data/products/22/2.jpg", "https://i.dummyjson.com/data/products/22/3.jpg"] }, { "id": 23, "title": "Orange Essence Food Flavou", "description": "Specifications of Orange Essence Food Flavour For Cakes and Baking Food Item", "price": 14, "discountPercentage": 8.04, "rating": 4.85, "stock": 26, "brand": "Baking Food Items", "category": "groceries", "thumbnail": "https://i.dummyjson.com/data/products/23/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/23/1.jpg", "https://i.dummyjson.com/data/products/23/2.jpg", "https://i.dummyjson.com/data/products/23/3.jpg", "https://i.dummyjson.com/data/products/23/4.jpg", "https://i.dummyjson.com/data/products/23/thumbnail.jpg"] }, { "id": 24, "title": "cereals muesli fruit nuts", "description": "original fauji cereal muesli 250gm box pack original fauji cereals muesli fruit nuts flakes breakfast cereal break fast faujicereals cerels cerel foji fouji", "price": 46, "discountPercentage": 16.8, "rating": 4.94, "stock": 113, "brand": "fauji", "category": "groceries", "thumbnail": "https://i.dummyjson.com/data/products/24/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/24/1.jpg", "https://i.dummyjson.com/data/products/24/2.jpg", "https://i.dummyjson.com/data/products/24/3.jpg", "https://i.dummyjson.com/data/products/24/4.jpg", "https://i.dummyjson.com/data/products/24/thumbnail.jpg"] }, { "id": 25, "title": "Gulab Powder 50 Gram", "description": "Dry Rose Flower Powder Gulab Powder 50 Gram • Treats Wounds", "price": 70, "discountPercentage": 13.58, "rating": 4.87, "stock": 47, "brand": "Dry Rose", "category": "groceries", "thumbnail": "https://i.dummyjson.com/data/products/25/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/25/1.png", "https://i.dummyjson.com/data/products/25/2.jpg", "https://i.dummyjson.com/data/products/25/3.png", "https://i.dummyjson.com/data/products/25/4.jpg", "https://i.dummyjson.com/data/products/25/thumbnail.jpg"] }, { "id": 26, "title": "Plant Hanger For Home", "description": "Boho Decor Plant Hanger For Home Wall Decoration Macrame Wall Hanging Shelf", "price": 41, "discountPercentage": 17.86, "rating": 4.08, "stock": 131, "brand": "Boho Decor", "category": "home-decoration", "thumbnail": "https://i.dummyjson.com/data/products/26/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/26/1.jpg", "https://i.dummyjson.com/data/products/26/2.jpg", "https://i.dummyjson.com/data/products/26/3.jpg", "https://i.dummyjson.com/data/products/26/4.jpg", "https://i.dummyjson.com/data/products/26/5.jpg", "https://i.dummyjson.com/data/products/26/thumbnail.jpg"] }, { "id": 27, "title": "Flying Wooden Bird", "description": "Package Include 6 Birds with Adhesive Tape Shape: 3D Shaped Wooden Birds Material: Wooden MDF, Laminated 3.5mm", "price": 51, "discountPercentage": 15.58, "rating": 4.41, "stock": 17, "brand": "Flying Wooden", "category": "home-decoration", "thumbnail": "https://i.dummyjson.com/data/products/27/thumbnail.webp", "images": ["https://i.dummyjson.com/data/products/27/1.jpg", "https://i.dummyjson.com/data/products/27/2.jpg", "https://i.dummyjson.com/data/products/27/3.jpg", "https://i.dummyjson.com/data/products/27/4.jpg", "https://i.dummyjson.com/data/products/27/thumbnail.webp"] }, { "id": 28, "title": "3D Embellishment Art Lamp", "description": "3D led lamp sticker Wall sticker 3d wall art light on/off button  cell operated (included)", "price": 20, "discountPercentage": 16.49, "rating": 4.82, "stock": 54, "brand": "LED Lights", "category": "home-decoration", "thumbnail": "https://i.dummyjson.com/data/products/28/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/28/1.jpg", "https://i.dummyjson.com/data/products/28/2.jpg", "https://i.dummyjson.com/data/products/28/3.png", "https://i.dummyjson.com/data/products/28/4.jpg", "https://i.dummyjson.com/data/products/28/thumbnail.jpg"] }, { "id": 29, "title": "Handcraft Chinese style", "description": "Handcraft Chinese style art luxury palace hotel villa mansion home decor ceramic vase with brass fruit plate", "price": 60, "discountPercentage": 15.34, "rating": 4.44, "stock": 7, "brand": "luxury palace", "category": "home-decoration", "thumbnail": "https://i.dummyjson.com/data/products/29/thumbnail.webp", "images": ["https://i.dummyjson.com/data/products/29/1.jpg", "https://i.dummyjson.com/data/products/29/2.jpg", "https://i.dummyjson.com/data/products/29/3.webp", "https://i.dummyjson.com/data/products/29/4.webp", "https://i.dummyjson.com/data/products/29/thumbnail.webp"] }, { "id": 30, "title": "Key Holder", "description": "Attractive DesignMetallic materialFour key hooksReliable & DurablePremium Quality", "price": 30, "discountPercentage": 2.92, "rating": 4.92, "stock": 54, "brand": "Golden", "category": "home-decoration", "thumbnail": "https://i.dummyjson.com/data/products/30/thumbnail.jpg", "images": ["https://i.dummyjson.com/data/products/30/1.jpg", "https://i.dummyjson.com/data/products/30/2.jpg", "https://i.dummyjson.com/data/products/30/3.jpg", "https://i.dummyjson.com/data/products/30/thumbnail.jpg"] }];

// starting
// let lastuser = localStorage.getItem("lastuser");
let lastuser = {
    fav: [],
    cart: []
};
let users = localStorage.getItem("users");
products.forEach(element => {
    element.saleprice = Math.round(element.price * (100 - element.discountPercentage)) / 100
});

//  variables
let filteredproducts = products.slice();
let prices = products.map((item) => item.price);
let maxPr = getmaxprice(prices);
let categories = getcategories(products);
let selectedcategories = [];
let sortlist = ["Популярности Убыв", "Популярности Возр", "Цене Убыв", "Цене Возр", "Остатку Убыв", "Остатку Возр"];
let userfav = lastuser.fav;
let usercart = lastuser.cart;
let favopen = false;

/// navigation
let favbtn = document.querySelector(".fav");
let cartbtn = document.querySelector(".cart");
favbtn.addEventListener("click", openfav);
cartbtn.addEventListener("click", opencart);

// reset filters
let resetbtn = document.querySelector(".resetfiltr");
resetbtn.addEventListener("click", resetfiltr);
/// Category form

let category_section = document.querySelector(".category");
let categories_section = document.querySelector(".categories");
for (const iterator of categories) {
    let newcategory = document.createElement("div");
    let newcategoryimg = document.createElement("img");
    let newcategorytitle = document.createElement("a");
    newcategory.classList.add("category-info");
    newcategory.id = iterator;
    newcategory.addEventListener("click", showcategory)
    newcategorytitle.innerHTML = iterator;
    for (const iter of products) {
        if (iterator == iter.category) {
            newcategoryimg.src = iter.thumbnail;
            break
        }

    }
    newcategory.append(newcategoryimg);
    newcategory.append(newcategorytitle);
    categories_section.append(newcategory);

}

/// Selected categories title

let categorytitle = document.querySelector(".catalog-titles");
let selectedcategorieslist = document.querySelector(".selectedcategories");
showcategorytitle(selectedcategories);

/// Sort list
let selectfield = document.querySelector(".top-section select");
sortlist.forEach(element => {
    let newsort = document.createElement("option");
    newsort.value = element;
    newsort.innerHTML = element;
    selectfield.append(newsort);
});
selectfield[0].classList.add("selected");
selectfield.addEventListener("change", (e) => {
    let sortname = e.target.value;
    let activsort = document.querySelector(".selected");
    activsort.classList.remove("selected")
    e.target[e.target.selectedIndex].classList.add("selected");
    showproducts(filteredproducts);
})

// Price range section   

let uppricebtn = document.querySelector(".price-title .up");
let downpricebtn = document.querySelector(".price-title .down");
let pricesection = document.querySelector(".wrapper");

uppricebtn.addEventListener("click", () => {
    downpricebtn.style.display = "block";
    pricesection.style.display = "none";
    uppricebtn.style.display = "none";
    resetpricefiltr();
    filterproducts();
});

downpricebtn.addEventListener("click", () => {
    downpricebtn.style.display = "none";
    pricesection.style.display = "block";
    uppricebtn.style.display = "block";

})

const rangeInput = document.querySelectorAll(".range-input input");
let priceInput = document.querySelectorAll(".price-input input");
let range = document.querySelector(".slider .progress");
let rangemin = document.querySelector(".range-min");
let rangemax = document.querySelector(".range-max");
let inputmin = document.querySelector(".input-min");
let inputmax = document.querySelector(".input-max");
rangemax.value = `${maxPr}`;
rangemax.max = `${maxPr}`;
rangemin.max = `${maxPr}`;
inputmax.value = `${maxPr}`;

let priceGap = 200;
priceInput.forEach(input => {
    input.addEventListener("input", e => {
        let minPrice = parseInt(priceInput[0].value),
            maxPrice = parseInt(priceInput[1].value);

        if ((maxPrice - minPrice >= priceGap) && maxPrice <= rangeInput[1].max) {
            if (e.target.className === "input-min") {
                rangeInput[0].value = minPrice;
                range.style.left = ((minPrice / rangeInput[0].max) * 100) + "%";
            } else {
                rangeInput[1].value = maxPrice;
                range.style.right = 100 - (maxPrice / rangeInput[1].max) * 100 + "%";
            }
        }
        filterproducts();
    });
});
rangeInput.forEach(input => {
    input.addEventListener("input", e => {
        let minVal = parseInt(rangeInput[0].value),
            maxVal = parseInt(rangeInput[1].value);

        console.log(minVal, maxVal)


        if ((maxVal - minVal) < priceGap) {
            if (e.target.className === "range-min") {
                rangeInput[0].value = maxVal - priceGap

            } else {
                rangeInput[1].value = minVal + priceGap;

            }
        } else {
            priceInput[0].value = minVal;
            priceInput[1].value = maxVal;
            range.style.left = ((minVal / rangeInput[0].max) * 100) + "%";
            range.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
        }
        filterproducts();
    });
});


// Category filtr section

let upcategorybtn = document.querySelector(".category-title .up");
let downcategorybtn = document.querySelector(".category-title .down");
let categorylist = document.querySelector(".category-list");
upcategorybtn.addEventListener("click", () => {
    downcategorybtn.style.display = "block";
    categorylist.style.display = "none";
    upcategorybtn.style.display = "none";
    resetcategoryfiltr();
    filterproducts();
});

downcategorybtn.addEventListener("click", () => {
    downcategorybtn.style.display = "none";
    categorylist.style.display = "flex";
    upcategorybtn.style.display = "block";
})

categories.forEach(element => {
    let filtrcategoryarray = products.filter(item => item.category == element)
    let newcategorylabel = document.createElement("label");
    let newcategorycheck = document.createElement("input");
    newcategorycheck.type = "checkbox";
    newcategorycheck.classList.add("check-category");
    newcategorycheck.value = element;
    newcategorycheck.id = "check_" + element;
    newcategorycheck.checked = false;
    newcategorylabel.append(newcategorycheck);
    newcategorylabel.innerHTML = newcategorylabel.innerHTML + "  " + element + `  <span>(${filtrcategoryarray.length})</span>`;
    categorylist.append(newcategorylabel);

    newcategorylabel.addEventListener("input", (e) => {

        let checkboxes = Array.from(document.querySelectorAll(".check-category"));
        let selectedcategorieslist = checkboxes.filter((item) => item.checked);
        selectedcategories = selectedcategorieslist.map((item) => item.value);
        showcategorytitle(selectedcategories);

        filterproducts();
    })

});

showproducts(filteredproducts);

/// modal forms 

let modalform = document.querySelector(".modal");
modalform.addEventListener("click", closemodal);


// functions 
// get variables
function getmaxprice(prices) {
    let maxPr = 0;
    prices.forEach(element => {
        if (element > maxPr) {
            maxPr = element;
        }
    });
    return maxPr
}

function getcategories(products) {
    let categories = [];
    for (const iter of products) {
        if (!categories.includes(iter.category)) {
            categories.push(iter.category)
        }

    }
    return categories
}

/// creating category form items

function showcategory() {
    category_section.style.display = "none"
}

function showcategorytitle(selectedcategories) {
    categorytitle.innerHTML = "";
    selectedcategorieslist.innerHTML = "";
    if (selectedcategories.length == 0) {
        let newtitle = document.createElement("div");
        newtitle.classList.add("catalog-title")
        newtitle.innerHTML = `<h2>Все товары</h2><span> (${products.length})</span>`;
        categorytitle.append(newtitle);
    } else {
        for (const iterator of selectedcategories) {
            let categoryarray = products.filter(item => item.category == iterator)
            let newtitle = document.createElement("div");
            newtitle.classList.add("catalog-title")
            newtitle.innerHTML = `<h2>${iterator}</h2><span> (${categoryarray.length})</span>`;
            categorytitle.append(newtitle);
            newtitle = document.createElement("div");
            newtitle.classList.add("selected-category")
            newtitle.innerHTML = `<h2>${iterator}</h2><img src="./images/Cross.png" alt="cross">`;
            selectedcategorieslist.append(newtitle);
            let crossbutton = newtitle.querySelector("img");
            crossbutton.addEventListener("click", (e) => {
                let categoryname = e.target.previousSibling.innerHTML;
                // console.dir(e.target.previousSibling.innerHTML)
                // selectedcategories = selectedcategories.slice(selectedcategories.indexOf(categoryname),1);
                let a = selectedcategories.splice(selectedcategories.indexOf(categoryname), 1);
                let checkedbox = document.getElementById("check_" + categoryname);
                checkedbox.checked = false;
                showcategorytitle(selectedcategories);
                filterproducts();
            })

        }

    }

}

// sorting

function sortproducts(filteredproducts) {
    let sortname = selectfield.value;
    sortproductsbyname(sortname);

}

function sortproductsbyname(sortname) {
    switch (sortname) {
        case "Популярности Убыв":
            sortproductsYX("rating")
            break;
        case "Популярности Возр":
            sortproductsXY("rating")
            break;
        case "Цене Убыв":
            sortproductsYX("price")
            break;
        case "Цене Возр":
            sortproductsXY("saleprice")
            break;
        case "Остатку Убыв":
            sortproductsYX("stock")
            break;
        case "Остатку Возр":
            sortproductsXY("stock")
            break;
        default:
            break;
    }

}

function sortproductsXY(fieldname) {
    filteredproducts.sort((x, y) => x[fieldname] - y[fieldname])
}

function sortproductsYX(fieldname) {
    filteredproducts.sort((x, y) => y[fieldname] - x[fieldname])
}

/// creating catalog form items

// filtering

function filterproducts() {
    let minprice = document.querySelector(".input-min").value;
    let maxprice = document.querySelector(".input-max").value;
    filteredproducts = products.filter((item) => {

        if (selectedcategories.length == 0) {
            return item.price <= maxprice && item.price >= minprice
        } else {
            return selectedcategories.includes(item.category) && item.saleprice <= maxprice && item.saleprice >= minprice
        }
    })

    showproducts(filteredproducts);
}

function resetfiltr() {
    resetpricefiltr();
    resetcategoryfiltr();
    filterproducts();
}

function resetcategoryfiltr() {
    let checkboxes = document.querySelectorAll(".check-category");
    checkboxes.forEach(element => {
        element.checked = false
    });

    selectedcategories = [];
    showcategorytitle(selectedcategories);
}
function resetpricefiltr() {
    rangemin.value = 0;
    rangemax.value = maxPr;
    inputmin.value = 0;
    inputmax.value = maxPr;
    range.style.left = "0%";
    range.style.right = "0%";
}




// creating

function showproducts(filteredproducts) {

    sortproducts(filteredproducts);
    let productssection = document.querySelector(".products-section");
    productssection.innerHTML = "";

    filteredproducts.forEach(element => {
        let productbox = document.createElement("div");
        productbox.classList.add("productbox");
        productbox.id = element.id;
        //stock
        let stockbox = document.createElement("div");
        stockbox.classList.add("stockbox");
        if (element.stock > 0) {
            stockbox.innerHTML = "<img src='./images/Frame (14).png' alt='instock'> " + `В наличии: ${element.stock}`

        } else {
            stockbox.innerHTML = "<img src='./images/Frame (13).png' alt='instock'> Нет в наличии";
        }
        productbox.append(stockbox);
        // sale

        if (element.discountPercentage > 0) {
            let salebox = document.createElement("div");
            salebox.classList.add("salebox");
            salebox.innerHTML = `SALE <br> <br> - ${element.discountPercentage}%`
            productbox.append(salebox);
        }
        // image
        let productimg = document.createElement("img");
        productimg.classList.add("foto");
        productimg.src = element.thumbnail;
        productbox.append(productimg);

        //rating
        let ratingbox = document.createElement("div");
        ratingbox.classList.add("ratingbox");
        let rating = element.rating;
        for (let index = 0; index < 5; index++) {
            if (rating >= 1) {
                ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-solid fa-star" style="color: #f6ab3a;"></i>'
            } else if (rating > 0) {
                ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-regular fa-star-half-stroke" style="color: #f6ab3a;"></i>'
            } else {
                ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-regular fa-star" style="color: #C4CDD5;"></i>'
            }
            rating--;
        }

        ratingbox.innerHTML = ratingbox.innerHTML + ` <span>(${element.rating})</span>` + ` &nbsp; <i class="fa-solid fa-thumbs-up" style="color: #14b853;"></i> &nbsp; &nbsp; <i class="fa-solid fa-thumbs-down fa-flip-horizontal" style="color: #ed0c0c;"></i>`;

        if (userfav.includes(element)) {
            ratingbox.innerHTML = ratingbox.innerHTML + ' &nbsp;&nbsp;&nbsp; &nbsp; <i class="fa-solid fa-heart" style="color: #e51520;"></i>';

        } else {
            ratingbox.innerHTML = ratingbox.innerHTML + ' &nbsp;&nbsp;&nbsp; &nbsp;<i class="fa-solid fa-heart" style="color: #C4CDD5;"></i>';
        }



        productbox.append(ratingbox);
        // title
        let producttitle = document.createElement("h2");
        producttitle.innerHTML = element.title
        productbox.append(producttitle);

        // id
        let productnumber = document.createElement("h1");
        productnumber.innerHTML = `# ${element.id}`
        productbox.append(productnumber);


        //prices
        let priceinfo = document.createElement("h3");
        if (element.saleprice == element.price) {
            priceinfo.innerHTML = `$ ${element.saleprice} &nbsp;&nbsp;&nbsp; <i class="fa-solid fa-cart-plus"></i>`
        } else {
            priceinfo.innerHTML = `$ ${element.saleprice} <span>$ ${element.price}</span> &nbsp;&nbsp;&nbsp; <i class="fa-solid fa-cart-plus"></i>`
        }

        productbox.append(priceinfo);
        productssection.append(productbox);


    });

    let favbtns = document.querySelectorAll(".fa-heart");
    let cartbtns = document.querySelectorAll(".fa-cart-plus");
    let itemimages = document.querySelectorAll(".productbox .foto");
    let itemtitles = document.querySelectorAll(".productbox h2");
    let likebtns = document.querySelectorAll(".fa-thumbs-up");
    let dlikebtns = document.querySelectorAll(".fa-thumbs-down");
    favbtns.forEach(element => {
        element.addEventListener("click", addfav);
    });
    cartbtns.forEach(element => {
        element.addEventListener("click", addcart);
    });
    itemimages.forEach(element => {
        element.addEventListener("click", openproduct);
    });
    itemtitles.forEach(element => {
        element.addEventListener("click", openproduct);
    });
    likebtns.forEach(element => {
        element.addEventListener("click", uprating);
    });
    dlikebtns.forEach(element => {
        element.addEventListener("click", downrating);
    });


}

// adding to favorits

function getproduct(btn) {
    let productid = btn.parentNode.parentNode.id;
    productid = productid.replace("p", "");
    let product = products.find((item) => item.id == productid);
    return product
}


function addfav() {

    let product = getproduct(this);
    let itemindex = userfav.indexOf(product);
    console.log(userfav)
    if (this.style.color == "rgb(229, 21, 32)") {
        if (itemindex >= 0) {
            const x = userfav.splice(itemindex, 1);
            this.style.color = "rgb(196, 205, 213)";
            if (favopen) {
                let itembox = document.getElementById(product.id);
                itembox.remove();
            }


        }

    } else {
        if (itemindex === -1) {
            userfav.push(product)
            this.style.color = "rgb(229, 21, 32)";

        }
    }

    updatefavcarticons();
    favtitleupdate();
}

function addcart() {
    let product = getproduct(this);
    let arrayitem = usercart.find((item) => item.product == product);
    if (arrayitem === undefined) {
        arrayitem = {
            'product': product,
            quantity: 1
        }
        usercart.push(arrayitem)
    } else {
        arrayitem.quantity++
    }
    updatefavcarticons();
}

function updatefavcarticons() {
    let favicon = document.querySelector(".fav span");
    if (userfav.length > 0) {
        favicon.innerHTML = `${userfav.length}`
        favicon.style.display = "inline"
    } else {
        favicon.style.display = "none"
    }
    let carticon = document.querySelector(".cart span");
    if (usercart.length > 0) {
        let summ = 0;
        usercart.forEach(element => {
            summ = summ + element.quantity;
        });

        carticon.innerHTML = `${summ}`
        carticon.style.display = "inline"
    } else {
        carticon.style.display = "none"
    }
}

function favtitleupdate() {
    let myfav = document.querySelector(".myfav");
    if (favopen) {
        myfav.innerHTML = `<h2>Избранные (${userfav.length})</h2><img src="./images/Cross.png" alt="cross">`;
        let crossbutton = myfav.querySelector("img");
        crossbutton.addEventListener("click", (e) => {
            favopen = false;
            favtitleupdate();
            filterproducts();
        })
    } else {
        myfav.innerHTML = "";

    }

}

function uprating() {
    let product = getproduct(this)

    if (product.rating < 5) {
        product.rating += 0.01
        product.rating = Math.round(product.rating * 100) / 100
        updatestars(this, product)
    }
}
function downrating() {
    let product = getproduct(this)
    if (product.rating > 0) {
        product.rating -= 0.01
        product.rating = Math.round(product.rating * 100) / 100
        updatestars(this, product)
    }
}



function updatestars(btn, product) {
    let thisbox = btn.parentNode;
    let rating = product.rating;
    let icons = thisbox.querySelectorAll("i");
    for (let index = 0; index < 5; index++) {
        if (rating >= 1) {
            icons[index].className = "fa-solid fa-star";
            icons[index].style.color = "#f6ab3a";
        } else if (rating > 0) {
            icons[index].className = "fa-regular fa-star-half-stroke";
            icons[index].style.color = "#f6ab3a";
        } else {
            icons[index].className = "fa-regular fa-star";
            icons[index].style.color = "#C4CDD5";

        }
        rating--;
    }
    let ratingspan = thisbox.querySelector("span");
    ratingspan.innerHTML = `(${product.rating})`;


}

function openfav() {

    if (userfav.length > 0) {
        favopen = true;
        favtitleupdate();
        showproducts(userfav);
    }

}
let cartform = document.querySelector(".cartform");
function opencart() {
    if (usercart.length>0) { 
    
    openmodal()

    let cartitems = document.querySelector(".cartitems");
    cartitems.innerHTML = "";
    total=0;
   usercart.forEach(element => {
    let product = element.product;
    let quantity = element.quantity;
    let cartitem = document.createElement("div")
    cartitem.classList.add("cartitem");
    cartitem.id = `c${product.id}`
    let foto = document.createElement("img");
    foto.src = product.thumbnail;
    cartitem.append(foto)
    let iteminfo =  document.createElement("div")
        iteminfo.classList.add("iteminfo");
    let itemtitle = document.createElement("h1")
        itemtitle.innerHTML = product.title;
        iteminfo.append(itemtitle);
    let itemprice = document.createElement("div")
         itemprice.classList.add("itemprice");
    let minusicon = document.createElement("i")
    minusicon.classname = "fa-solid fa-minus";
    itemprice.append(minusicon);
    let quantityinput = document.createElement("input")
    quantityinput.type = "number";
    quantityinput.min=0;
    quantityinput.max = product.stock;
    quantityinput.value = quantity;
    itemprice.append(quantityinput);
    let plusicon = document.createElement("i")
    plusicon.classname = "fa-solid fa-plus";
    itemprice.append(plusicon);
    iteminfo.append(itemprice);
    let price = document.createElement("h3")
    price.innerHTML = `${product.saleprice} $`
    itemprice.append(price);



    let removeitem = document.createElement("img")
    removeitem.src = "./images/Frame (18).png"
    removeitem.alt = "remove"
    iteminfo.append(removeitem);
    cartitem.append(iteminfo);
    cartitems.append(cartitem);

    total = total + quantity*product.saleprice;

   });
   let carttotal = document.querySelector(".carttotal h2");
   carttotal.innerHTML = `${total} $`
   cartform.style.display = "block";
}    
}

let productform = document.querySelector(".productform");

function openproduct() {
    let productid = this.parentNode.id;
    let product = products.find((item) => item.id == productid);
    let productinfo = document.querySelector(".productinfo");
    let infosection = document.querySelector(".infosection");
    let foto = document.querySelector(".productinfo img");
    let images = document.querySelector(".productimages");
    infosection.innerHTML = "";
    infosection.id = `p${this.parentNode.id}`;
    images.innerHTML = "";
    //stock
    let stockbox = document.createElement("div");
    stockbox.classList.add("stockbox");

    if (product.stock > 0) {
        stockbox.innerHTML = "<img src='./images/Frame (14).png' alt='instock'> " + `В наличии: ${product.stock}`

    } else {
        stockbox.innerHTML = "<img src='./images/Frame (13).png' alt='instock'> Нет в наличии";
    }
    infosection.append(stockbox);

    // sale

    if (product.discountPercentage > 0) {
        let salebox = document.createElement("div");
        salebox.classList.add("salebox");
        salebox.innerHTML = `SALE <br> <br> - ${product.discountPercentage}%`
        infosection.append(salebox);
    }
    // image

    foto.src = product.thumbnail;


    //rating
    let ratingbox = document.createElement("div");
    ratingbox.classList.add("ratingbox");
    let rating = product.rating;
    for (let index = 0; index < 5; index++) {
        if (rating >= 1) {
            ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-solid fa-star" style="color: #f6ab3a;"></i>'
        } else if (rating > 0) {
            ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-regular fa-star-half-stroke" style="color: #f6ab3a;"></i>'
        } else {
            ratingbox.innerHTML = ratingbox.innerHTML + '<i class="fa-regular fa-star" style="color: #C4CDD5;"></i>'
        }
        rating--;
    }

    ratingbox.innerHTML = ratingbox.innerHTML + ` <span>(${product.rating})</span>` + ` &nbsp; <i class="fa-solid fa-thumbs-up" style="color: #14b853;"></i> &nbsp; &nbsp; <i class="fa-solid fa-thumbs-down fa-flip-horizontal" style="color: #ed0c0c;"></i>`;

    if (userfav.includes(product)) {
        ratingbox.innerHTML = ratingbox.innerHTML + ' &nbsp;&nbsp;&nbsp; &nbsp; <i class="fa-solid fa-heart" style="color: #e51520;"></i>';

    } else {
        ratingbox.innerHTML = ratingbox.innerHTML + ' &nbsp;&nbsp;&nbsp; &nbsp;<i class="fa-solid fa-heart" style="color: #C4CDD5;"></i>';
    }

    infosection.append(ratingbox);
    // title
    let producttitle = document.createElement("h2");
    producttitle.innerHTML = product.title
    infosection.append(producttitle);
    // id
    let productnumber = document.createElement("h1");
    productnumber.innerHTML = `# ${product.id}`
    infosection.append(productnumber);

    // info 

    let productdescription = document.createElement("p");
    productdescription.innerHTML = product.description;
    infosection.append(productdescription);

    //prices
    let priceinfo = document.createElement("h3");
    if (product.saleprice == product.price) {
        priceinfo.innerHTML = `$ ${product.saleprice} &nbsp;&nbsp;&nbsp; <i class="fa-solid fa-cart-plus"></i>`
    } else {
        priceinfo.innerHTML = `$ ${product.saleprice} <span>$ ${product.price}</span> &nbsp;&nbsp;&nbsp; <i class="fa-solid fa-cart-plus"></i>`
    }

    infosection.append(priceinfo);

    productform.style.display = "block";


    let favbtns = infosection.querySelector(".fa-heart");
    let cartbtns = infosection.querySelector(".fa-cart-plus");
    let likebtns = infosection.querySelector(".fa-thumbs-up");
    let dlikebtns = infosection.querySelector(".fa-thumbs-down");

    favbtns.addEventListener("click", addfav);
    cartbtns.addEventListener("click", addcart);
    likebtns.addEventListener("click", uprating);
    dlikebtns.addEventListener("click", downrating);



    product.images.forEach(element => {

let newfoto = document.createElement("img")
  newfoto.src = element;
  newfoto.alt = "foto"
  images.append(newfoto);
  newfoto.addEventListener("click", (e)=>{ 
    let foto = document.querySelector(".productinfo img");
    foto.src = e.target.src;
  })
    });



    openmodal();

}

function openmodal() {
    modalform.style.display = "flex";
}

function closemodal() {
    modalform.style.display = "none";
    productform.style.display = "none";
    cartform.style.display = "none";
    showproducts(filteredproducts)
}